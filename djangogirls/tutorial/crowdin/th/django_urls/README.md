# Django urls

เรากำลังจะสร้างหน้าเว็บแรกของเรา: เป็นหน้าแรกสำหรับบล็อกของคุณ! แต่ก่อนอื่น มาดูกันเรื่อง Django urls เสียหน่อย

## URL คืออะไร?

URL นั้นคือที่อยู่ของเว็บ คุณเห็น URL ทุกครั้งที่เข้าดูเว็บไซต์ - มันปรากฎอยู่ในช่องที่อยู่ของเบราว์เซอร์ของคุณ (ใช่แล้ว! `127.0.0.1:8000` ก็คือ URL! และ `https://djangogirls.com` ก็คือ URL เช่นกัน):

![Url][1]

 [1]: images/url.png

ทุกหน้าเว็บบนอินเทอร์เน็ต ต้องมี URL เป็นของตัวเอง วิธีนี้ทำให้โปรแกรมเว็บของเรารู้ว่า ควรแสดงหน้าไหนให้คนที่เปิด URL ใน Django เราใช้สิ่งที่เรียกว่า `URLconf` (URL configuration) URLconf คือชุดของรูปแบบที่ Django จะพยายามจับคู่ให้ตรงกับ URL ที่ได้รับมาเพื่อหา view ที่ถูกต้องให้

## URL ทำงานอย่างไรใน Django?

ลองเปิดไฟล์ `mysite/urls.py` ขึ้นมาและดูว่าข้างในเป็นอย่างไร:

    python
    from django.conf.urls import include, url
    from django.contrib import admin
    
    urlpatterns = [
        # Examples:
        # url(r'^$', 'mysite.views.home', name='home'),
        # url(r'^blog/', include('blog.urls')),
    
        url(r'^admin/', include(admin.site.urls)),
    ]
    

อย่างที่คุณเห็น Django ได้เตรียมไว้ให้เราบ้างแล้ว

บรรทัดที่ขึ้นต้นด้วย `#` คือ comment - หมายความว่าโค้ดที่อยู่บรรทัดนั้นๆ จะไม่ถูกรันโดย Python สะดวกดี ใช่ไหม?

admin URL คือหน้าที่คุณเคยเข้าในบทที่แล้ว ในบรรทัดนี้:

    python
        url(r'^admin/', include(admin.site.urls)),
    

ตรงนี้หมายความว่า ทุก URL ที่ขึ้นต้นด้วย `admin/` Django จะหา *view* ที่สอดคล้องให้ ในกรณีนี้ เราจะรวม admin URL ทั้งหลาย โดยไม่ต้องใส่ในทุกบรรทัด -- ทำให้อ่านง่ายและดูสะอาดตายิ่งขึ้น

## Regex

คุณสงสัยไหมว่า Django จับคู่ URL เข้ากับ view ยังไง? ตรงนี้จะซับซ้อนนิดหน่อย Django ใช้ `regex` ย่อมาจาก "regular expressions" Regex มีกฎที่มากมาย (มากมายจริงๆ!) ที่ใช้เป็นรูปแบบในการค้นหา เนื่องจาก regexe เป็นหัวข้อขั้นสูง เราจะไม่ลงรายละเอียดมากนัก

ถ้าคุณอยากเข้าใจวิธีที่เราสร้างรูปแบบเหล่านี้ นี่คือตัวอย่างรูปแบบ - เราต้องการสรุปให้เหลือเฉพาะกฎที่เราใช้ในการหารูปแบบที่เราต้องการ ได้แก่:

    ^ สำหรับ จุดเริ่มต้นของข้อความ
    $ สำหรับ จุดสิ้นสุดของข้อความ
    \d สำหรับ ตัวเลข
    + บอกว่า สิ่งที่หาอยู่ก่อนหน้า ควรจะปรากฎซ้ำอย่างน้อยหนึ่งครั้ง
    () เพื่อเอาเฉพาะบางส่วนของรูปแบบ
    

อื่นๆ นอกเหนือจากข้อกำหนด url นี้ จะถูกนำไปใช้ตรงไปตรงมา

ตอนนี้คุณลองนึกดูว่า คุณมีเว็บไซต์มีที่อยู่ดังนี้: `http://www.mysite.com/post/12345/` โดยที่ `12345` คือหมายเลขของโพสต์คุณ

การเขียนหน้า view สำหรับทุกหมายเลขโพสต์ คงจะทำให้น่ารำคาญมาก ด้วย regular expression คุณสามารถเขียนรูปแบบที่ตรงกับ url และนำหมายเลขโพสต์ออกมาให้เรา: `^post/(\d+)/$` มาดูรายละเอียดแต่ละอัน ว่าอะไรเป็นอย่างไร:

*   **^post/** บอก Django ว่า จะใช้อะไรก็ตามที่ url นำหน้าด้วย `post/` (ต่อท้าย `^`)
*   **(\d+)** หมายความว่า ตรงนี้ต้องเป็นตัวเลข (หนึ่งตัวหรือมากกว่า) และเราต้องการหมายเลขนี้แหละ
*   **/** บอก django ว่ามี `/` ต่อท้ายอีกอัน
*   **$** บ่งบอกถึงจุดสิ้นสุดของ URL หมายถึงว่า url ต้องลงท้ายด้วย `/` เท่านั้นถึงจะตรงกับรูปแบบนี้

## Django url แรกของคุณ!

ถึงเวลาสร้าง URL แรกกันแล้ว! เราต้องการ 'http://127.0.0.1:8000/' ให้เป็นหน้าแรกของบล็อกเรา และแสดงรายการของโพสต์ทั้งหมด

นอกจากนี้เรายังต้องการให้ไฟล์ `mysite/urls.py` อ่านง่ายและสะอาดตา ดังนั้น เราจะ import url มาจาก application `blog` ไปยังไฟล์หลักคือ `mysite/urls.py`

จัดการลบบรรทัดที่มี comment (บรรทัดที่ขึ้นต้นด้วย `#`) และเพิ่มบรรทัดที่จะ import `blog.urls` เข้าไปใน url หลัก (`''`).

ไฟล์ `mysite/urls.py` ของคุณควรมีหน้าตาดังนี้:

    python
    from django.conf.urls import include, url
    from django.contrib import admin
    
    urlpatterns = [
        url(r'^admin/', include(admin.site.urls)),
        url(r'', include('blog.urls')),
    ]
    

Django จะจัดการทุกคำร้องขอที่เข้ามาที่ 'http://127.0.0.1:8000/' ไปยัง `blog.urls` และดูว่าจะทำอะไรต่อจากนี้

เมื่อเขียน regular expression ใน Python จะทำโดยมี `r` นำหน้าข้อความทุกกฏเสมอ ซึ่งเป็นประโยชน์กับ Python เพราะอาจจะมีอักขระพิเศษที่มีผลกับ regular expression

## blog.urls

สร้างไฟล์ใหม่ชื่อ `blog/urls.py` เอาล่ะ! แก้ไขไฟล์เป็นดังนี้:

    python
    from django.conf.urls import url
    from . import views
    

ตรงนี้เราได้ทำการ import Django method รวมถึง `views` จากแอพ `blog` (เรายังไม่มีในตอนนี้ แต่เราจะมีในไม่ช้า!)

ต่อมา เราจะเพิ่มรูปแบบ URL ของเรา:

    python
    urlpatterns = [
        url(r'^$', views.post_list, name='post_list'),
    ]
    

อย่างที่คุณเห็น ตอนนี้เรากำหนดให้ `view` ชื่อ `post_list` ให้กับ URL `^$` regular expression นี้จะจับคู่ `^` (ขึ้นต้น) ตามด้วย `$` (สิ้นสุด) - ดังนั้น ข้อความว่างเท่านั้นจึงจะถูกต้องกับกฎนี้ ซึ่งถูกต้อง เพราะ Django ประมวลดูว่า URL 'http://127.0.0.1:8000/' นั้นไม่ใช่ส่วนหนึ่งของ URL รูปแบบนี้จะบอก Django ว่า `views.post_list` คือที่ๆ ต้องมาดู เมื่อมีใครสักคนเข้ามายังหน้า 'http://127.0.0.1:8000/'

ส่วนสุดท้าย `name='post_list'` คือชื่อของ URL ที่จะถูกใช้เพื่อระบุว่าคือ view ไหน ตรงนี้สามารถใช้ชื่อเดียวกันกับ view ได้ แต่ก็ยังคงเป็นสิ่งที่แตกต่างกันอย่างสิ้นเชิงได้เช่นกัน เราจะใช้ชื่อของ URL ในภายหลัง เพราะฉะนั้น การตั้งชื่อให้สื่อและไม่ซ้ำกันนั้นสำคัญมาก

เอาล่ะทุกอย่างโอเคแล้ว? ลองเปิด http://127.0.0.1:8000/ ในเบราว์เซอร์ของคุณเพื่อดูผลลัพธ์กัน

![ข้อผิดพลาด][2]

 [2]: images/error1.png

ตอนนี้ไม่มีหน้า "It works" แล้ว? ไม่ต้องกังวล เป็นเพียงหน้าข้อผิดพลาด ไม่มีอะไรต้องกลัว! เพราะมันก็มีประโยชน์เหมือนกัน:

คุณจะเห็นว่ามันคือ **no attribute 'post_list'** แล้ว *post_list* ทำให้คุณนึกอะไรได้บ้างนะ? นี่คือสิ่งที่เราเรียกว่า view ไงล่ะ! ซึ่งหมายความว่า ทุกอย่างเข้าที่เข้าทางแล้ว แต่เรายังไม่ได้สร้าง *view* เท่านั้นเอง ไม่ต้องกลัว เราจะสร้างแน่

> หากคุณต้องการข้อมูลเพิ่มเติมเกี่ยวกับ Django URLconf คุณสามารถดูได้ที่หน้าเอกสารของโครงการ Django: https://docs.djangoproject.com/en/1.8/topics/http/urls/